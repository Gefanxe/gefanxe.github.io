<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>é‡è©ç·´ç¿’éŠæˆ²ï½œç„¡é™éš¨æ©Ÿãƒ»è§¸ç¢°ä½œç­”ï¼ˆ50é¡Œï¼‹æ³¨éŸ³ï¼‰</title>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://gefanxe.github.io/mabau-game-1.html" />
  <meta property="og:title" content="é‡è©ç·´ç¿’éŠæˆ²ï½œç„¡é™éš¨æ©Ÿãƒ»è§¸ç¢°ä½œç­”ï¼ˆ50é¡Œï¼‹æ³¨éŸ³ï¼‰" />
  <meta property="og:description" content="å°ˆç‚º6æ­²å­©ç«¥è¨­è¨ˆçš„ä¸­æ–‡é‡è©ç·´ç¿’éŠæˆ²ï¼Œ50å€‹ç²¾å¿ƒè¨­è¨ˆçš„é¡Œç›®ï¼Œæ¯é¡Œéƒ½é™„æœ‰æ³¨éŸ³ï¼Œå¹«åŠ©å­¸ç¿’ç™¼éŸ³ã€‚äº’å‹•å¼å­¸ç¿’ï¼Œè®“å­©å­åœ¨éŠæˆ²ä¸­å¿«æ¨‚å­¸ç¿’é‡è©ï¼" />
  <meta property="og:image" content="https://gefanxe.github.io/images/preview.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://gefanxe.github.io/mabau-game-1.html" />
  <meta name="twitter:title" content="é‡è©ç·´ç¿’éŠæˆ²ï½œç„¡é™éš¨æ©Ÿãƒ»è§¸ç¢°ä½œç­”ï¼ˆ50é¡Œï¼‹æ³¨éŸ³ï¼‰" />
  <meta name="twitter:description" content="å°ˆç‚º6æ­²å­©ç«¥è¨­è¨ˆçš„ä¸­æ–‡é‡è©ç·´ç¿’éŠæˆ²ï¼Œ50å€‹ç²¾å¿ƒè¨­è¨ˆçš„é¡Œç›®ï¼Œæ¯é¡Œéƒ½é™„æœ‰æ³¨éŸ³ï¼Œå¹«åŠ©å­¸ç¿’ç™¼éŸ³ã€‚äº’å‹•å¼å­¸ç¿’ï¼Œè®“å­©å­åœ¨éŠæˆ²ä¸­å¿«æ¨‚å­¸ç¿’é‡è©ï¼" />
  <meta name="twitter:image" content="https://gefanxe.github.io/images/preview.png" />
  
  <!-- ä¸€èˆ¬ meta æ¨™ç±¤ -->
  <meta name="description" content="å°ˆç‚º6æ­²å­©ç«¥è¨­è¨ˆçš„ä¸­æ–‡é‡è©ç·´ç¿’éŠæˆ²ï¼Œ50å€‹ç²¾å¿ƒè¨­è¨ˆçš„é¡Œç›®ï¼Œæ¯é¡Œéƒ½é™„æœ‰æ³¨éŸ³ï¼Œå¹«åŠ©å­¸ç¿’ç™¼éŸ³ã€‚äº’å‹•å¼å­¸ç¿’ï¼Œè®“å­©å­åœ¨éŠæˆ²ä¸­å¿«æ¨‚å­¸ç¿’é‡è©ï¼" />
  <meta name="keywords" content="é‡è©,ä¸­æ–‡å­¸ç¿’,å…’ç«¥æ•™è‚²,æ³¨éŸ³ç¬¦è™Ÿ,èªè¨€å­¸ç¿’,æ•™è‚²éŠæˆ²" />
  <link type="text/css" rel="stylesheet" href="./assets/phon.css" charset="utf8">
  <style>
    /* -----------------------------------------------------------
       å…§åµŒ Bootswatchï¼šYeti é¢¨æ ¼ï¼ˆç¯€éŒ„ä¸¦å¾®èª¿ï¼‰
       èªªæ˜ï¼šä¾è¦å‰‡å¾ bootswatch ä¸»é¡Œä¸­éš¨æ©ŸæŒ‘é¸ä¸¦æ•´åˆæ–¼ <style>ã€‚
       è‘—é‡è‰²å½©ã€æŒ‰éˆ•ã€å¡ç‰‡ã€é™°å½±ã€æ’ç‰ˆï¼ˆå·²èª¿æ•´ç‚ºæš–è‰²ç³»ï¼‰ã€‚
    ------------------------------------------------------------*/
    :root{
      --primary:#ff7043;     /* ä¸»è‰²ï¼šæ´»æ½‘æ©˜ */
      --primary-dark:#f4511e;
      --bg:#fff3e0;          /* èƒŒæ™¯ï¼šæ·ºæ©™ */
      --text:#4e342e;        /* æ–‡å­—ï¼šæ·±æ£• */
      --card:#ffffff;        /* å¡ç‰‡åº•è‰² */
      --good:#2e7d32;        /* æ­£è§£ï¼šç¶  */
      --bad:#c62828;         /* èª¤ç­”ï¼šç´… */
      --muted:#6d4c41;       /* æ¬¡è¦æ–‡å­— */
    }

    /* å…¨åŸŸæ’ç‰ˆèˆ‡ RWD */
    html,body{height:100%;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      display:flex;
      justify-content:center;
      padding:24px 24px 48px 24px;
      min-height:100vh;
      min-height:100dvh; /* å‹•æ…‹è¦–çª—é«˜åº¦ï¼Œé©é… iPhone åº•éƒ¨å·¥å…·åˆ— */
      /* é‡å° iPhone Safari çš„å®‰å…¨å€åŸŸèª¿æ•´ */
      padding-bottom:max(48px, env(safe-area-inset-bottom));
    }

    /* å®¹å™¨å¡ç‰‡ï¼šæ¡å¡ç‰‡+é™°å½±é¢¨æ ¼ */
    .app{
      width:min(960px,100%);
      background:var(--card);
      border-radius:24px;
      box-shadow:0 20px 40px rgba(0,0,0,0.08);
      padding:clamp(16px,3vw,28px);
      display: flex;
      flex-direction: column;
      min-height: calc(100vh - 96px);
      min-height: calc(100dvh - 96px); /* å‹•æ…‹è¦–çª—é«˜åº¦ */
      max-height: calc(100vh - 96px);
      max-height: calc(100dvh - 96px); /* ç¢ºä¿ä¸è¶…éè¦–çª—é«˜åº¦ */
      overflow-y: auto; /* å¦‚æœ‰éœ€è¦å¯æ»¾å‹• */
    }

    /* æ¨™é¡Œåˆ—ï¼šemoji + Bootstrap Icons é¢¨æ ¼ï¼ˆä»¥emojiæ›¿ä»£ï¼‰ */
    .header{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }

    /* æ¨™é¡Œå·¦å´å€åŸŸ */
    .title-section{
      width: 100%;
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:clamp(20px,3.2vw,28px);
      font-weight:800;
      color:var(--primary-dark);
    }

    /* æ¨™é¡Œå€åŸŸçš„åˆ‡æ›æŒ‰éˆ• */
    .title-controls{
      display:flex;
      align-items:center;
      gap:8px;
    }

    .title-btn{
      font-size:14px;
      border:none;
      background: #ffe0b2;
      color:#6d4c41;
      font-weight:600;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
      box-shadow:0 4px 8px rgba(244,81,30,.25);
      transition:background .2s ease, transform .06s ease;
      touch-action:manipulation;
      white-space:nowrap;
    }
    .title-btn:hover{ background:#ffd08a; }
    .title-btn:active{ transform:translateY(1px); }
    .title-btn.active{ background:var(--primary); color:#fff; }
    .title-btn.active:hover{ background:var(--primary-dark); }


    .scoreboard{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:clamp(16px,2.4vw,20px);
      color:var(--muted);
    }
    .badge{
      background:var(--primary);
      color:#fff;
      padding:6px 12px;
      border-radius:999px;
      font-weight:700;
      box-shadow:0 6px 16px rgba(244,81,30,.25);
    }

    /* é¡Œç›®å¡ */
    .card{
      background:#fff;
      border:1px solid #ffe0b2;
      border-radius:20px;
      padding:clamp(14px,3vw,24px);
      /* margin-top:8px; */
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .prompt{
      display: flex;
      justify-content: center;
      align-content: center;
      gap:10px;
      /* margin: 0 auto; */
    }

    /* åˆå§‹éš±è—æç¤ºå€å¡Š */
    .prompt.hidden {
      display: none;
    }

    .emoji{
      font-size:clamp(70px,8vw,80px);
      vertical-align: super;
    }
    #noun {
      display: flex;
      justify-content: space-evenly;
    }
    /* .noun{
      font-family: BopomofoRuby, 'AR KaiB5', 'KaiTi TW', 'æ¨™æ¥·é«”';
      font-size:clamp(34px,3vw,38px);
      color:#5d4037;
      writing-mode: vertical-rl;
      -webkit-writing-mode: vertical-rl;
      -moz-writing-mode: vertical-rl;
      text-orientation: upright;
    } */

    .ansBtn {
      color:#fff
    }

    .ansBtn [data-after]::after {
      color:#fff
    }

    /* ruby {
      ruby-position: under;
      margin: 16px 0;
    } */

    /* ruby rb{ } */

    /* ruby rt{
      color:#8d6e63;
      margin-left: 4px;
    }

    ruby.ans rb{
      font-size: 1.3em;
    }

    ruby.ans rt{
      font-size:.7em;
      color:#ffffff;
      margin-top: 5px;
    } */

    .ansScope {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: end;
    }


    /* é¸é …å€ï¼š2æ¬„ RWDï¼Œå¹³æ¿ä»¥ä¸Š 4 æ¬„ */
    .options{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      /* margin-top:16px; */
      /* display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap: 5px;
      flex: 1;
      align-content: stretch; */
    }
    /* @media (min-width:720px){
      .options{ 
        grid-template-columns:repeat(4, minmax(0,1fr)); 
        align-content: end;
      }
    } */

    /* é¸é …æŒ‰éˆ• */
    .opt{
      width: 120px;
      height: 80px;
      border:none;
      border-radius:16px;
      font-size:clamp(24px,2.4vw,28px);
      font-weight:600;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(255,112,67,.28);
      transition:transform .06s ease, background .2s ease, box-shadow .2s ease;
      touch-action:manipulation;
    }
    .opt:hover{ background:var(--primary-dark); }
    .opt:active{ transform:translateY(1px); }

    /* PC è¢å¹•å°ºå¯¸æ™‚é™åˆ¶æŒ‰éˆ•æœ€å¤§å°ºå¯¸ */
    /* @media (min-width:720px){
      .opt{
        max-width: 200px;
        max-height: 80px;
        margin: 0 auto;
      }
    } */

    /* ä½œç­”å¾Œç‹€æ…‹ */
    .opt.correct{ background:var(--good); box-shadow:0 10px 20px rgba(46,125,50,.28); }
    .opt.wrong{ background:var(--bad); box-shadow:0 10px 20px rgba(198,40,40,.28); }

    /* æ§åˆ¶åˆ— */
    .controls{
      margin-top: 5px;
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      justify-content:space-evenly;
    }

    #startBtn {
      /* height: 100px; */
      font-size: x-large;
    }

    .btn{
      font-size:larger;
      border:none;
      background:#ffe0b2;
      color:#6d4c41;
      font-weight:500;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 6px 12px rgba(0,0,0,.06);
      transition:background .2s ease, transform .06s ease;
      touch-action:manipulation;
    }
    .btn:hover{ background:#ffd08a; }
    .btn:active{ transform:translateY(1px); }
    .btn.primary{ background:var(--primary); color:#fff; }
    .btn.primary:hover{ background:var(--primary-dark); }

    /* æŒ‰éˆ•éš±è—æ¨£å¼ */
    .btn.hidden {
      display: none;
    }
    
    .title-btn.hidden {
      display: none;
    }

    /* éš±è— emoji å’Œæ³¨éŸ³çš„æ¨£å¼ */
    .emoji.hidden-content {
      visibility: hidden;
    }
    
    ruby rt.hidden-content {
      display: none;
    }

    /* å›é¥‹è¨Šæ¯ */
    .feedback{
      /* height: 71px; */
      min-height:1.8em;
      text-align:center;
      margin-bottom: 16px;
      font-size:clamp(18px,2.6vw,22px);
      font-weight:800;
    }
    .feedback.ok{ color:var(--good); }
    .feedback.no{ color:var(--bad); }

    /* è¦å‰‡6ï¼šé¿å…è¼¸å…¥å…ƒä»¶æº¢å‡ºå®¹å™¨ */
    *{ box-sizing:border-box; }
    input, select, textarea{ max-width:100%; }

    /* Footer æ¨£å¼ */
    .footer{
      padding-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      color: var(--muted);
      font-size: 16px;
      position: relative;
      margin-top: auto;
    }
    .footer-center{
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .footer img{
      width: 32px;
      height: 32px;
      object-fit: contain;
    }
    .footer-text{
      font-weight: 600;
      color: var(--text);
    }
    .footer-year{
      position: absolute;
      right: 0;
      font-weight: 600;
      color: #ffb74c;
    }

    /* é¼“å‹µæ–‡å­—å€å¡Š */
    .welcome-message {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
      font-size: clamp(18px, 3vw, 22px);
      line-height: 1.6;
      margin: 20px 0;
    }

    .welcome-message h2 {
      color: var(--primary-dark);
      font-size: clamp(24px, 4vw, 32px);
      margin-bottom: 20px;
      font-weight: 500;
    }

    .welcome-message p {
      margin: 16px 0;
      font-weight: 600;
    }

    .welcome-message.hidden {
      display: none;
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DKDD5CFQ4C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DKDD5CFQ4C');
  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DKDD5CFQ4C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DKDD5CFQ4C');
  </script>
</head>
<body>
  <main class="app">
    <!-- æ¨™é¡Œï¼‹åˆ†æ•¸æ¿ -->
    <div class="header">
      <div class="title-section">
        <div class="title">ğŸ¯ é‡è©ç·´ç¿’éŠæˆ²</div>
        <div class="title-controls">
          <button id="toggleEmojiBtn" class="title-btn hidden">åœ–</button>
          <button id="toggleZyBtn" class="title-btn hidden">æ³¨</button>
        </div>
      </div>
      <div class="scoreboard">
        ğŸ“Š åˆ†æ•¸ <span id="score" class="badge">0</span>
        âœ… é€£çºŒç­”å° <span id="streak" class="badge" style="background:#66bb6a;box-shadow:0 6px 16px rgba(102,187,106,.25)">0</span>
      </div>
    </div>

    <!-- é¡Œç›®å¡ -->
    <section class="card">
      <!-- æ­¡è¿è¨Šæ¯ -->
      <div id="welcomeMessage" class="welcome-message">
        <h2 id="encourageText"></h2>
      </div>

      <div class="prompt hidden">
        <span id="emoji" class="emoji">ğŸ</span>
        <!-- <span id="noun" class="noun"> -->
        <span class="dummy2 tb v after">
          <div id="noun">
            <!-- ä»¥ ruby é¡¯ç¤ºï¼šä¸­æ–‡å­— + æ³¨éŸ³ -->

          </div>
        </span>
      </div>

      <div class="ansScope" >
        <!-- å›é¥‹ -->
        <div id="feedback" class="feedback"></div>
        
        <!-- é¸é …æŒ‰éˆ•ï¼ˆé‡è©ï¼‹æ³¨éŸ³ï¼‰ -->
        <div id="options" class="options"></div>
        
        <div style="height: 1.5em;"></div>
  
        <!-- æ§åˆ¶åˆ— -->
        <div class="controls">
          <button id="startBtn" class="btn primary">â–¶ï¸ é–‹å§‹ç·´ç¿’</button>
          <button id="nextBtn" class="btn hidden">ä¸‹ä¸€é¡Œ</button>
          <button id="resetBtn" class="btn hidden">é‡æ–°é–‹å§‹</button>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-center">
        <img src="./images/Facebook_Logo_Primary.png" alt="Facebook Logo">
        <span class="footer-text">å°äºåª½ã„Ÿç”¨èŠ¯ç”Ÿæ´»</span>
      </div>
      <div class="footer-year">2025.09</div>
    </footer>
  </main>

  <script>
    /* -----------------------------------------------------------
      é—œéµèªªæ˜ï¼ˆè¨»è§£ï¼‰ï¼š
      1) è³‡æ–™çµæ§‹ï¼šæ¯é¡Œå«ã€Œemojiã€é¡Œç›®ä¸­æ–‡å­—ã€é¡Œç›®æ³¨éŸ³ã€æ­£ç¢ºé‡è©ã€é‡è©æ³¨éŸ³ã€ã€‚
      2) å‡ºé¡Œï¼šéš¨æ©ŸæŠ½é¡Œä¸¦ç”Ÿæˆ 4 å€‹é‡è©é¸é …ï¼ˆå«æ­£è§£ + 3 å€‹å¹²æ“¾ï¼‰ã€‚
      3) äº’å‹•ï¼šè§¸ç¢°æŒ‰éˆ•å³ä½œç­”ï¼›ç«‹å³é¡¯ç¤ºæ­£èª¤ä¸¦ä¸Šè‰²ï¼Œæ’­æ”¾éŸ³æ•ˆã€‚
      4) RWDï¼šæŒ‰éˆ•ç¶²æ ¼æœƒéš¨è¢å¹•å¯¬åº¦åˆ‡æ› 2~4 æ¬„ã€‚
      5) ç„¡é™æ¨¡å¼ï¼šä¸çµæŸï¼›å¯æŒ‰ã€Œä¸‹ä¸€é¡Œã€æˆ–ç­”é¡Œå®Œè‡ªå‹•åˆ‡æ›ï¼ˆ1.2ç§’ï¼‰ã€‚
    ------------------------------------------------------------*/

    // é‡è©æ¸…å–®ï¼ˆæä¾›éš¨æ©Ÿå¹²æ“¾ç”¨ï¼‰
    const MEASURES = [
      {han:"é¡†",zy:"ã„ã„œ"}, {han:"éš»",zy:"ã„“"}, {han:"æœ¬",zy:"ã„…ã„£Ë‡"}, {han:"æ”¯",zy:"ã„“"},
      {han:"æŠŠ",zy:"ã„…ã„šË‡"}, {han:"å¼µ",zy:"ã„“ã„¤"}, {han:"è¼›",zy:"ã„Œã„§ã„¤Ë‹"}, {han:"å°",zy:"ã„Šã„ËŠ"},
      {han:"éƒ¨",zy:"ã„…ã„¨Ë‹"}, {han:"å€‹",zy:"ã„ã„œË‹"}, {han:"å°",zy:"ã„ˆã„¥"}, {han:"é›™",zy:"ã„•ã„¨ã„¤"},
      {han:"æ¢",zy:"ã„Šã„§ã„ ËŠ"}, {han:"ä»¶",zy:"ã„ã„§ã„¢Ë‹"}, {han:"é ‚",zy:"ã„‰ã„§ã„¥Ë‡"}, {han:"å‰¯",zy:"ã„ˆã„¨Ë‹"},
      {han:"æœµ",zy:"ã„‰ã„¨ã„›Ë‡"}, {han:"æ£µ",zy:"ã„ã„œ"}, {han:"åº§",zy:"ã„—ã„¨ã„›Ë‹"}, {han:"æ£Ÿ",zy:"ã„‰ã„¨ã„¥Ë‹"},
      {han:"è¼ª",zy:"ã„Œã„¨ã„£ËŠ"}, {han:"æ‰‡",zy:"ã„•ã„¢Ë‹"}
    ];

    // é¡Œåº« 50 é¡Œï¼ˆé¡Œç›®ï¼‹æ­£ç¢ºé‡è©ï¼Œå…¨å«æ³¨éŸ³ï¼‰
    const DATA = [
      {emo:"ğŸ", n:["è˜‹","æœ"], nz:["ã„†ã„§ã„¥ËŠ","ã„ã„¨ã„›Ë‡"], m:"é¡†", mz:"ã„ã„œ"},
      {emo:"ğŸ¶", n:["ç‹—"], nz:["ã„ã„¡Ë‡"], m:"éš»", mz:"ã„“"},
      {emo:"ğŸ±", n:["è²“"], nz:["ã„‡ã„ "], m:"éš»", mz:"ã„“"},
      {emo:"ğŸŸ", n:["é­š"], nz:["ã„©ËŠ"], m:"æ¢", mz:"ã„Šã„§ã„ ËŠ"},
      {emo:"ğŸ¦", n:["é³¥"], nz:["ã„‹ã„§ã„ Ë‡"], m:"éš»", mz:"ã„“"},
      {emo:"ğŸ“–", n:["æ›¸"], nz:["ã„•ã„¨"], m:"æœ¬", mz:"ã„…ã„£Ë‡"},
      {emo:"ğŸ–Šï¸", n:["ç­†"], nz:["ã„…ã„§Ë‡"], m:"æ”¯", mz:"ã„“"},
      {emo:"â˜‚ï¸", n:["é›¨","å‚˜"], nz:["ã„©Ë‡","ã„™ã„¢Ë‡"], m:"æŠŠ", mz:"ã„…ã„šË‡"},
      {emo:"ğŸª‘", n:["æ¤…","å­"], nz:["ã„§Ë‡","ã„—Ë™"], m:"å¼µ", mz:"ã„“ã„¤"},
      {emo:"ğŸš—", n:["è»Š"], nz:["ã„”ã„œ"], m:"è¼›", mz:"ã„Œã„§ã„¤Ë‹"},
      {emo:"ğŸš²", n:["å–®","è»Š"], nz:["ã„‰ã„¢","ã„”ã„œ"], m:"å°", mz:"ã„Šã„ËŠ"},
      {emo:"ğŸ–¥ï¸", n:["é›»","è…¦"], nz:["ã„‰ã„§ã„¢Ë‹","ã„‹ã„ Ë‡"], m:"å°", mz:"ã„Šã„ËŠ"},
      {emo:"ğŸ“±", n:["æ‰‹","æ©Ÿ"], nz:["ã„•ã„¡Ë‡","ã„ã„§"], m:"éƒ¨", mz:"ã„…ã„¨Ë‹"},
      {emo:"ğŸ“º", n:["é›»","è¦–"], nz:["ã„‰ã„§ã„¢Ë‹","ã„•Ë‹"], m:"éƒ¨", mz:"ã„…ã„¨Ë‹"},
      {emo:"ğŸ¥¤", n:["æ¯","å­"], nz:["ã„…ã„Ÿ","ã„—Ë™"], m:"å€‹", mz:"ã„ã„œË‹"},
      {emo:"âœ‰ï¸", n:["ä¿¡"], nz:["ã„’ã„§ã„£Ë‹"], m:"å°", mz:"ã„ˆã„¥"},
      {emo:"ğŸ‘Ÿ", n:["é‹","å­"], nz:["ã„’ã„§ã„ËŠ","ã„—Ë™"], m:"é›™", mz:"ã„•ã„¨ã„¤"},
      {emo:"ğŸ¥¢", n:["ç­·","å­"], nz:["ã„ã„¨ã„Ë‹","ã„—Ë™"], m:"é›™", mz:"ã„•ã„¨ã„¤"},
      {emo:"ğŸ‘–", n:["è¤²","å­"], nz:["ã„ã„¨Ë‹","ã„—Ë™"], m:"æ¢", mz:"ã„Šã„§ã„ ËŠ"},
      {emo:"ğŸ‘—", n:["è£™","å­"], nz:["ã„‘ã„©ã„£ËŠ","ã„—Ë™"], m:"ä»¶", mz:"ã„ã„§ã„¢Ë‹"},
      {emo:"ğŸ‘•", n:["è¡£","æœ"], nz:["ã„§","ã„ˆã„¨ËŠ"], m:"ä»¶", mz:"ã„ã„§ã„¢Ë‹"},
      {emo:"ğŸ§¢", n:["å¸½","å­"], nz:["ã„‡ã„ Ë‹","ã„—Ë™"], m:"é ‚", mz:"ã„‰ã„§ã„¥Ë‡"},
      {emo:"ğŸ§¤", n:["æ‰‹","å¥—"], nz:["ã„•ã„¡Ë‡","ã„Šã„ Ë‹"], m:"å‰¯", mz:"ã„ˆã„¨Ë‹"},
      {emo:"ğŸ‘“", n:["çœ¼","é¡"], nz:["ã„§ã„¢Ë‡","ã„ã„§ã„¥Ë‹"], m:"å‰¯", mz:"ã„ˆã„¨Ë‹"},
      {emo:"ğŸ—ºï¸", n:["åœ°","åœ–"], nz:["ã„‰ã„§Ë‹","ã„Šã„¨ËŠ"], m:"å¼µ", mz:"ã„“ã„¤"},
      {emo:"ğŸ–¼ï¸", n:["ç›¸","ç‰‡"], nz:["ã„’ã„§ã„¤Ë‹","ã„†ã„§ã„¢Ë‹"], m:"å¼µ", mz:"ã„“ã„¤"},
      {emo:"ğŸ«", n:["ç¥¨"], nz:["ã„†ã„§ã„ Ë‹"], m:"å¼µ", mz:"ã„“ã„¤"},
      {emo:"ğŸ“„", n:["ç´™"], nz:["ã„“Ë‡"], m:"å¼µ", mz:"ã„“ã„¤"},
      {emo:"ğŸª", n:["é¤…","ä¹¾"], nz:["ã„…ã„§ã„¥Ë‡","ã„ã„¢"], m:"ç‰‡", mz:"ã„†ã„§ã„¢Ë‹"},
      {emo:"ğŸ‚", n:["è›‹","ç³•"], nz:["ã„‰ã„¢Ë‹","ã„ã„ "], m:"å¡Š", mz:"ã„ã„¨ã„Ë‹"},
      {emo:"ğŸ¥¯", n:["éºµ","åŒ…"], nz:["ã„‡ã„§ã„¢Ë‹","ã„…ã„ "], m:"å€‹", mz:"ã„ã„œË‹"},
      {emo:"ğŸ‰", n:["è¥¿","ç“œ"], nz:["ã„’ã„§","ã„ã„¨ã„š"], m:"é¡†", mz:"ã„ã„œ"},
      {emo:"ğŸŒ¸", n:["èŠ±"], nz:["ã„ã„¨ã„š"], m:"æœµ", mz:"ã„‰ã„¨ã„›Ë‡"},
      {emo:"ğŸŒ³", n:["æ¨¹"], nz:["ã„•ã„¨Ë‹"], m:"æ£µ", mz:"ã„ã„œ"},
      {emo:"â›°ï¸", n:["å±±"], nz:["ã„•ã„¢"], m:"åº§", mz:"ã„—ã„¨ã„›Ë‹"},
      {emo:"ğŸ ", n:["æˆ¿","å­"], nz:["ã„ˆã„¤ËŠ","ã„—Ë™"], m:"æ£Ÿ", mz:"ã„‰ã„¨ã„¥Ë‹"},
      {emo:"ğŸŒ‰", n:["æ©‹"], nz:["ã„‘ã„§ã„ ËŠ"], m:"åº§", mz:"ã„—ã„¨ã„›Ë‹"},
      {emo:"ğŸï¸", n:["æ²³"], nz:["ã„ã„œËŠ"], m:"æ¢", mz:"ã„Šã„§ã„ ËŠ"},
      {emo:"ğŸ›¤ï¸", n:["è·¯"], nz:["ã„Œã„¨Ë‹"], m:"æ¢", mz:"ã„Šã„§ã„ ËŠ"},
      {emo:"â˜ï¸", n:["é›²"], nz:["ã„©ã„£ËŠ"], m:"æœµ", mz:"ã„‰ã„¨ã„›Ë‡"},
      {emo:"â­", n:["æ˜Ÿ","æ˜Ÿ"], nz:["ã„’ã„§ã„¥","ã„’ã„§ã„¥"], m:"é¡†", mz:"ã„ã„œ"},
      {emo:"ğŸŒ", n:["å¤ª","é™½"], nz:["ã„Šã„Ë‹","ã„§ã„¤ËŠ"], m:"é¡†", mz:"ã„ã„œ"},
      {emo:"ğŸŒ•", n:["æœˆ","äº®"], nz:["ã„©ã„Ë‹","ã„Œã„§ã„¤Ë‹"], m:"è¼ª", mz:"ã„Œã„¨ã„£ËŠ"},
      {emo:"ğŸª¥", n:["ç‰™","åˆ·"], nz:["ã„§ã„šËŠ","ã„•ã„¨ã„š"], m:"æ”¯", mz:"ã„“"},
      {emo:"ğŸ’¡", n:["ç‡ˆ","æ³¡"], nz:["ã„‰ã„¥","ã„†ã„ Ë‹"], m:"é¡†", mz:"ã„ã„œ"},
      {emo:"ğŸ—ï¸", n:["é‘°","åŒ™"], nz:["ã„§ã„ Ë‹","ã„•Ë™"], m:"æŠŠ", mz:"ã„…ã„šË‡"},
      {emo:"ğŸšª", n:["é–€"], nz:["ã„‡ã„£ËŠ"], m:"æ‰‡", mz:"ã„•ã„¢Ë‹"},
      {emo:"ğŸªŸ", n:["çª—","æˆ¶"], nz:["ã„”ã„¨ã„¤","ã„ã„¨Ë‹"], m:"æ‰‡", mz:"ã„•ã„¢Ë‹"}
    ];

    // ç‹€æ…‹
    let score = 0;
    let streak = 0;
    let current = null;
    let usedIndex = -1;
    let lock = false; // é˜²é€£é»
    let audioLock = false; // é˜²æ­¢éŸ³æ•ˆæ’­æ”¾ä¸­è¢«æ‰“æ–·
    let showEmoji = true; // æ§åˆ¶ emoji é¡¯ç¤ºç‹€æ…‹
    let showZhuyin = true; // æ§åˆ¶æ³¨éŸ³é¡¯ç¤ºç‹€æ…‹
    let autoNextTimer = null; // è‡ªå‹•è·³é¡Œè¨ˆæ™‚å™¨
    
    // éŸ³é »ä¸Šä¸‹æ–‡ï¼ˆå…¨åŸŸå…±ç”¨ï¼Œé¿å…é‡è¤‡å‰µå»ºï¼‰
    let audioContext = null;
    
    // åˆå§‹åŒ–éŸ³é »ä¸Šä¸‹æ–‡
    function initAudioContext() {
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          console.warn('Audio context creation failed:', e);
        }
      }
      return audioContext;
    }

    // é¼“å‹µè©±èªé™£åˆ—
    const ENCOURAGE_MESSAGES = [
      "ğŸŒˆ ä¸€èµ·ä¾†å­¸é‡è©å§ï¼",
      "â­ ä½ æ˜¯æœ€æ£’çš„ï¼",
      "ğŸ¦‹ æ…¢æ…¢ä¾†ï¼Œæˆ‘å€‘ä¸€å®šæœƒå­¸å¾—æœƒï¼",
      "ğŸŒ¸ ä»Šå¤©è¦é–‹å¿ƒå­¸ç¿’å–”ï¼",
      "ğŸ» ç›¸ä¿¡è‡ªå·±ï¼Œä½ å¾ˆè°æ˜ï¼",
      "ğŸˆ é€™æ¬¡è¦ç­”å°å¹¾é¡Œï¼Ÿ",
      "ğŸŒº é€™æ¬¡æŒ‘æˆ°æˆåŠŸæœ‰ä»€éº¼çå‹µï¼Ÿ",
      "ğŸŒŸ ç­‰ä¸€ä¸‹æœƒå²å®³çš„åš‡åˆ°æˆ‘å—ï¼",
      "ğŸ¦„ é€™æ¬¡è¦è®Šå¾—æ›´å²å®³ï¼",
      "ğŸ€ åŠ æ²¹ï¼æˆ‘å€‘å¯ä»¥åšå¾—å¾ˆå¥½ï¼"
    ];

    // DOM
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const emojiEl = document.getElementById('emoji');
    const nounEl  = document.getElementById('noun');
    const optsEl  = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const startBtn = document.getElementById('startBtn');
    const nextBtn  = document.getElementById('nextBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toggleEmojiBtn = document.getElementById('toggleEmojiBtn');
    const toggleZyBtn = document.getElementById('toggleZyBtn');
    const promptEl = document.querySelector('.prompt');
    const welcomeMessageEl = document.getElementById('welcomeMessage');
    const encourageTextEl = document.getElementById('encourageText');

    // Web Audio APIï¼šç­”å°/ç­”éŒ¯æ—‹å¾‹
    function beep(ok=true){
      if(audioLock) return; // é˜²æ­¢éŸ³æ•ˆé‡ç–Š
      
      const ctx = initAudioContext();
      if (!ctx) return; // å¦‚æœéŸ³é »ä¸Šä¸‹æ–‡å‰µå»ºå¤±æ•—ï¼Œéœé»˜è¿”å›
      
      // ç¢ºä¿éŸ³é »ä¸Šä¸‹æ–‡è™•æ–¼é‹è¡Œç‹€æ…‹
      if (ctx.state === 'suspended') {
        ctx.resume().catch(e => console.warn('Audio context resume failed:', e));
      }
      
      audioLock = true;
      let totalDuration = 0;
      
      try {
        if(ok){
          // ç­”å°æ—‹å¾‹ï¼šDo-Mi-Sol ä¸Šè¡ŒéŸ³éš (C-E-G)
          const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
          notes.forEach((freq, i) => {
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = 'triangle';
            o.frequency.value = freq;
            o.connect(g);
            g.connect(ctx.destination);
            
            const startTime = ctx.currentTime + i * 0.15;
            g.gain.setValueAtTime(0.001, startTime);
            g.gain.exponentialRampToValueAtTime(0.23, startTime + 0.03);
            g.gain.exponentialRampToValueAtTime(0.001, startTime + 0.12);
            
            o.start(startTime);
            o.stop(startTime + 0.12);
          });
          totalDuration = 3 * 0.15; // 0.45ç§’
        } else {
          // ç­”éŒ¯æ—‹å¾‹ï¼šSol-Mi-Do ä¸‹è¡ŒéŸ³éš (G-E-C)
          const notes = [783.99, 659.25, 523.25]; // G5, E5, C5
          notes.forEach((freq, i) => {
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = 'sawtooth';
            o.frequency.value = freq;
            o.connect(g);
            g.connect(ctx.destination);
            
            const startTime = ctx.currentTime + i * 0.18;
            g.gain.setValueAtTime(0.001, startTime);
            g.gain.exponentialRampToValueAtTime(0.12, startTime + 0.02);
            g.gain.exponentialRampToValueAtTime(0.001, startTime + 0.15);
            
            o.start(startTime);
            o.stop(startTime + 0.15);
          });
          totalDuration = 3 * 0.18; // 0.54ç§’
        }
        
        // éŸ³æ•ˆæ’­æ”¾å®Œæˆå¾Œè§£é™¤é–å®š
        setTimeout(() => {
          audioLock = false;
        }, (totalDuration + 0.1) * 1000); // å¤šåŠ 0.1ç§’ç·©è¡
        
      } catch (e) {
        console.warn('Audio playback failed:', e);
        audioLock = false; // ç™¼ç”ŸéŒ¯èª¤æ™‚ç«‹å³è§£é™¤é–å®š
      }
    }

    // å·¥å…·ï¼šéš¨æ©Ÿæ•´æ•¸
    const rnd = (n)=> Math.floor(Math.random()*n);

    // å·¥å…·ï¼šå¾ MEASURES å–ä¸åŒçš„å¹²æ“¾é¸é …
    function pickDistractors(correct, count=3){
      const pool = MEASURES.filter(m=>m.han!==correct.han);
      const out = [];
      while(out.length<count && pool.length){
        const i = rnd(pool.length);
        out.push(pool.splice(i,1)[0]);
      }
      return out;
    }

    // åˆ‡æ› emoji é¡¯ç¤º/éš±è—
    function toggleEmoji() {
      showEmoji = !showEmoji;
      
      if (showEmoji) {
        emojiEl.classList.remove('hidden-content');
        toggleEmojiBtn.classList.remove('active');
      } else {
        emojiEl.classList.add('hidden-content');
        toggleEmojiBtn.classList.add('active');
      }
    }

    // åˆ‡æ›æ³¨éŸ³é¡¯ç¤º/éš±è—
    function toggleZhuyin() {
      showZhuyin = !showZhuyin;
      
      if (showZhuyin) {
        toggleZyBtn.classList.remove('active');
        // é¡¯ç¤ºæ‰€æœ‰æ³¨éŸ³
        document.querySelectorAll('idiv').forEach(idiv => {
          idiv.dataset.after = idiv.dataset.after2;
        });
      } else {
        toggleZyBtn.classList.add('active');
        // éš±è—æ‰€æœ‰æ³¨éŸ³
        document.querySelectorAll('idiv').forEach(idiv => {
          idiv.dataset.after2 = idiv.dataset.after;
          idiv.dataset.after = '';
        });
      }
    }

    // é¡Œé¢æ¸²æŸ“ï¼ˆå«æ³¨éŸ³ rubyï¼‰
    function renderPrompt(q){
      emojiEl.textContent = q.emo;
      
      // å°‡é™£åˆ—æ ¼å¼çš„ä¸­æ–‡å­—èˆ‡æ³¨éŸ³çµ„åˆæˆ ruby æ¨™ç±¤
      const rubyPairs = q.n.map((char, index) => `
<idiv data-after="${showZhuyin ? q.nz[index] : ''}" data-after2="${showZhuyin ? '' : q.nz[index]}">${char}</idiv>
      `);
      nounEl.innerHTML = rubyPairs.join('');
      
      // æ ¹æ“šç•¶å‰ç‹€æ…‹è¨­ç½® emoji é¡¯ç¤º
      if (!showEmoji) {
        emojiEl.classList.add('hidden-content');
      } else {
        emojiEl.classList.remove('hidden-content');
      }
    }

    // ç”¢ç”Ÿä¸€é¡Œ
    function newQuestion(){
      // æ¸…é™¤ä»»ä½•æ­£åœ¨é€²è¡Œçš„è‡ªå‹•è·³é¡Œè¨ˆæ™‚å™¨
      if (autoNextTimer) {
        clearTimeout(autoNextTimer);
        autoNextTimer = null;
      }
      
      // å¦‚æœéŸ³æ•ˆæ­£åœ¨æ’­æ”¾ï¼Œç­‰å¾…ä¸€å°æ®µæ™‚é–“å†åŸ·è¡Œ
      if(audioLock) {
        setTimeout(() => newQuestion(), 100);
        return;
      }
      
      lock = false;
      feedbackEl.textContent = '';
      feedbackEl.className = 'feedback';

      // é¿å…é€£çºŒåŒé¡Œ
      let idx;
      do{ idx = rnd(DATA.length); }while(idx===usedIndex && DATA.length>1);
      usedIndex = idx;
      current = DATA[idx];

      renderPrompt(current);

      // æ­£è§£é‡è©ç‰©ä»¶
      const correct = {han:current.m, zy:current.mz};

      // ç”Ÿæˆé¸é …ï¼ˆæ­£è§£ + 3 å¹²æ“¾ï¼‰ï¼Œä¸¦æ´—ç‰Œ
      const options = [correct, ...pickDistractors(correct,3)]
        .sort(()=>Math.random()-0.5);

      // ç¹ªè£½æŒ‰éˆ•ï¼ˆé‡è©ï¼‹æ³¨éŸ³ï¼‰
      optsEl.innerHTML = '';
      options.forEach(op=>{
        const btn = document.createElement('button');
        btn.className = 'opt';
        btn.innerHTML = `
<div style="margin: 0 auto;" class="dummy2 tb v after">
  <div class="ansBtn">
    <idiv data-after="${showZhuyin ? op.zy : ''}" data-after2="${showZhuyin ? '' : op.zy}">${op.han}</idiv>
  </div>
</div>
`;
        btn.onclick = ()=> choose(op, correct, btn);
        optsEl.appendChild(btn);
      });
    }

    // ä½œç­”
    function choose(sel, correct, btn){
      if(lock) return;
      lock = true;

      // æ¸…é™¤ä»»ä½•æ­£åœ¨é€²è¡Œçš„è‡ªå‹•è·³é¡Œè¨ˆæ™‚å™¨
      if (autoNextTimer) {
        clearTimeout(autoNextTimer);
        autoNextTimer = null;
      }

      const isOk = sel.han===correct.han;
      if(isOk){
        score++; streak++;
        scoreEl.textContent = score;
        streakEl.textContent = streak;
        feedbackEl.textContent = 'å¤ªæ£’äº†ï¼ç­”å°äº†ğŸ‘';
        feedbackEl.className = 'feedback ok';
        btn.classList.add('correct');
        beep(true);
        // ç­”å°æ™‚1.3ç§’å¾Œè‡ªå‹•ä¸‹ä¸€é¡Œï¼Œä½¿ç”¨è¨ˆæ™‚å™¨è®Šæ•¸è¿½è¹¤
        autoNextTimer = setTimeout(()=>{
          autoNextTimer = null;
          newQuestion();
        }, 1300);
      }else{
        streak = 0;
        streakEl.textContent = streak;
        feedbackEl.innerHTML = `
  å†æƒ³æƒ³ï½æ­£ç¢ºé‡è©æ˜¯ï¼š
  <span class="dummy2 tb v after">
    <span style="font-size: 26px;">
      <idiv data-after="${showZhuyin ? correct.zy : ''}" data-after2="${showZhuyin ? '' : correct.zy}">${correct.han}</idiv>
    </span>
  </span>
        `;
        feedbackEl.className = 'feedback no';
        btn.classList.add('wrong');
        // é«˜äº®æ­£è§£
        [...optsEl.children].forEach(b=>{
          if(b.textContent.trim().includes(correct.han)) b.classList.add('correct');
        });
        beep(false);
        // ç­”éŒ¯æ™‚ä¸è‡ªå‹•è·³é¡Œï¼Œéœ€æ‰‹å‹•æŒ‰ä¸‹ä¸€é¡Œ
      }
    }

    // éš¨æ©Ÿé¸æ“‡é¼“å‹µè©±èª
    function setRandomEncourageMessage() {
      const randomIndex = rnd(ENCOURAGE_MESSAGES.length);
      encourageTextEl.textContent = ENCOURAGE_MESSAGES[randomIndex];
    }

    // äº‹ä»¶ï¼šé–‹å§‹ï¼ä¸‹ä¸€é¡Œï¼é‡ç½®
    startBtn.onclick = ()=>{
      // åˆå§‹åŒ–éŸ³é »ä¸Šä¸‹æ–‡ï¼ˆéœ€è¦ç”¨æˆ¶äº’å‹•æ‰èƒ½å•Ÿå‹•ï¼‰
      initAudioContext();
      
      score = 0; streak = 0;
      scoreEl.textContent = score;
      streakEl.textContent = streak;
      
      // éš±è—æ­¡è¿è¨Šæ¯ï¼Œé¡¯ç¤ºæç¤ºå€å¡Š
      welcomeMessageEl.classList.add('hidden');
      promptEl.classList.remove('hidden');
      
      // éš±è—é–‹å§‹æŒ‰éˆ•ï¼Œé¡¯ç¤ºå…¶ä»–æ§åˆ¶æŒ‰éˆ•
      startBtn.classList.add('hidden');
      nextBtn.classList.remove('hidden');
      toggleEmojiBtn.classList.remove('hidden');
      toggleZyBtn.classList.remove('hidden');
      resetBtn.classList.remove('hidden');
      
      newQuestion();
    };
    nextBtn.onclick = ()=> {
      // æ¸…é™¤è‡ªå‹•è·³é¡Œè¨ˆæ™‚å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      if (autoNextTimer) {
        clearTimeout(autoNextTimer);
        autoNextTimer = null;
      }
      newQuestion();
    };
    toggleEmojiBtn.onclick = toggleEmoji;
    toggleZyBtn.onclick = toggleZhuyin;
    resetBtn.onclick = ()=>{
      // æ¸…é™¤è‡ªå‹•è·³é¡Œè¨ˆæ™‚å™¨
      if (autoNextTimer) {
        clearTimeout(autoNextTimer);
        autoNextTimer = null;
      }
      
      // å¦‚æœéŸ³æ•ˆæ­£åœ¨æ’­æ”¾ï¼Œå¼·åˆ¶åœæ­¢
      if(audioLock) {
        audioLock = false;
        if (audioContext && audioContext.state === 'running') {
          // åœæ­¢æ‰€æœ‰æ­£åœ¨é€²è¡Œçš„éŸ³é »ç¯€é»
          try {
            audioContext.suspend();
          } catch (e) {
            console.warn('Failed to suspend audio context:', e);
          }
        }
      }
      
      score = 0; streak = 0;
      scoreEl.textContent = score;
      streakEl.textContent = streak;
      feedbackEl.textContent = '';
      feedbackEl.className = 'feedback';
      lock = false; // é‡ç½®é–å®šç‹€æ…‹
      
      // é¡¯ç¤ºæ­¡è¿è¨Šæ¯ï¼Œéš±è—æç¤ºå€å¡Š
      welcomeMessageEl.classList.remove('hidden');
      promptEl.classList.add('hidden');
      
      // é‡æ–°éš¨æ©Ÿé¸æ“‡é¼“å‹µè©±èª
      setRandomEncourageMessage();
      
      // é‡ç½®æŒ‰éˆ•é¡¯ç¤ºç‹€æ…‹
      startBtn.classList.remove('hidden');
      nextBtn.classList.add('hidden');
      toggleEmojiBtn.classList.add('hidden');
      toggleZyBtn.classList.add('hidden');
      resetBtn.classList.add('hidden');
      
      // é‡ç½®æç¤ºé¡¯ç¤ºç‹€æ…‹
      showEmoji = true;
      showZhuyin = true;
      toggleEmojiBtn.classList.remove('active');
      toggleZyBtn.classList.remove('active');
      
      // æ¸…ç©ºé¡Œç›®é¡¯ç¤º
      emojiEl.textContent = '';
      emojiEl.classList.remove('hidden-content');
      nounEl.innerHTML = '';
      optsEl.innerHTML = '';
    };

    // åˆæ¬¡è¼‰å…¥ï¼šè¨­å®šéš¨æ©Ÿé¼“å‹µè©±èª
    setRandomEncourageMessage();
  </script>
</body>
</html>
